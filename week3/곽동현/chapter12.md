<details>
<summary> 동기화란? </summary>

- 프로세스의 대전제 : 프로세스/스레드들은 동시다발적으로 수행되며, 서로간 협력하며 영향을 주고받는다. 이 과정에서 자원의 일관성이 보장되어야 문제가 생기지 않는다.

## (프로세스) 동기화란?
- 프로세스들의 수행 시기를 맞추는 것
- 실행 순서 제어 : 프로세스들은 올바른 순서대로 실행하기
- 상호 배제 : 동시에 접근해서는 안 되는 자원에 하나의 프로세스만 접근하게 하기

## 실행 순서 제어를 위한 동기화
### reader / writer problem
- **Writer** : Book.txt 파일에 값을 저장하는 프로세스 (쓰기 실행)
- **Reader** : Book.txt 파일에 저장된 값을 읽어들이는 프로세스 (읽기 실행)

Reader / Writer 간 프로세스들은 서로 아무렇게나 실행되어선 안된다.  
각자의 실행 순서가 보장 되어야 한다.
- ex) reader 는 writer 가 쓰기가 되어 파일이 존재해야한다.

## 상호 배제를 위한 동기화 (동시에 접근해서는 안되는 자원에 동시 접근)
### Bank account problem
- 공유가 불가능한 자원의 동시 사용을 피하기 위한 동기화

한 번에 하나의 프로세스만 접근해야 하는 자원에 동시 접근을 피하기 위한 동기화
- ex) 10만원 짜리 계좌에 A / B 가 동시에 입금/출금

### Producer & Consumer problem
- **Producer** : 물건을 계속해서 생산하는 생산자
- **Consumer** : 물건을 계속해서 소비하는 소비자

생산자 / 소비자 간의 **총 합**은 동일해야한다.
- ex) producer = 총 합 += 1 / consumer = 총합 -= 1 동시에 실행

### 용어 정리
- 공유 자원 : 여러 프로세스 혹은 스레드가 공유하는 자원
    - 전역 변수 , 파일 , 입출력장치 등
- 임계 구역 : 동시에 실행하면 문제가 발생하는 자원에 접근하는 코드 영역
    - 트랜잭션으로 묶어야 하는 공간
- Race Condition : 임계구역에 동시에 접근하여 자원에 일관성이 꺠질 수 있는 상황

## 운영체제가 임계구역 문제를 해결하는 세 가지 원칙
- 상호 배제 (mutual exclusion)
    - 한 프로세스가 임계 구역에 진입했다면, 다른 프로세스는 들어올 수 없다.
- 진행 (progress)
    - 임계 구역에 어떤 프로세스도 진입하지 않앗다면, 진입하고자 하는 프로세스는 들어갈 수 있어야 한다.
- 유한 대기 (bounded waiting)
    - 한 프로세스가 임계구역에 진입하고 싶다면, **언젠가는** 임계 구역에 들어올 수 있어야 한다.
    - 임계 구역에 들어오기 위해 무한정 대기해서는 안된다.

</details>

<br>
<details>
<summary> 동기화 기법 </summary>

## 뮤텍스 락
- 상호 배제를 위한 도구(ex) 화장실의 자물쇠 역할)
- lock 의 여부를 지속적으로 확인하며 대기한다. (리소스낭비)

```angular2html
구현 방법
전역 변수 1개 ,함수 2개
- 자물쇠 역할 : 프로세스들이 공유하는 전역 변수 lock
- 임계 구역을 잠그는 역할 : acquire() 함수
- 임계 구역의 잠금을 해제하는 역할 : release() 함수
```
```java
acquire(){
    while(lock == true){
    }
    lock = true;    // 자물쇠가 잠겨 있는지 확인, 잠겨있지 않다면, 잠그고 들어가기
};  
// 임계구역 작업
release(){
    lock = false;  // 임계구역 작업을 끝내고 자물쇠 반환  
}
```

## 세마포
- 공유 자원이 여러개여도 활용가능(화장실 칸이 여러개)
- 임계 구역 앞에서 멈춤 신호를 받으면 잠시 대기
- 임구 구역 앞에서 가도 좋다는 신호를 받으면 임계 구역 진입
- 뮤텍스와 같이 lock 의 여부를 지속적으로 확인하며 대기한다. (리소스낭비)
    - 사용할 수 있는 자원이 없을 경우 **대기 상태**로 만들어서 리소스 낭비를 방지한다. (PCB 를 대기 큐에 삽입)
    - 사용할 수 있는 자원이 생겼을 때 대기 큐의 프로세스를 **준비 상태**로 만든다. (대기큐 PCB -> 준비큐 이동)
- 세마포를 활용하여 실행순서 제어(동기화)도 가능하다.
    - S를 0으로 설정
    - A 뒤에 signal() 함수 붙이기 => 첫번째 활동
    - B 앞에 wait() 함수 붙이기 => 두번째 활동

```angular2html
구현 방법
전역 변수 1개, 함수 2개
- 임계 구역에 진입할 수 있는 프로세스의 개수(사용 가능한 공유 자원의 개수)를 나타내는 전역변수 S
- 임계 구역에 들어가도 좋은지, 기다려야 할 지를 알려주는 wait() 함수
- 임계 구역 앞에서 기다리는 프로세스에 '이제 가도 좋다' 라고 신호를 주는 signal() 함수
```
```java
wait(){
    S--;
    if(S < 0){
        "add this process to Queue;"
        sleep();
    }
}
signal(){
    S++;
    if(S <= 0){
        "remove a process p from Queue;"
        wakeup(p);
    }
}
```

### 자바 진영에서 세마포어
- 자바 진영에서 세마포어는 사실상 직접적으로 쓰이지는 않지만, 개념적으로는 HikariCP 와 같은 쓰레드 풀 개념으로 착안이 된다.
- 세마포어 (지금 이 자원에 동시에 몇 개까지 접근 가능할까?)
  - DB 커넥션 제한 (지금 동시에 몇 개의 작업을 실행할 수 있을까?)
  - 외부 API 동시 호출 제한 등


## 모니터
- 인터페이스를 위한 큐
- 공유자원에 접근하고자 하는 프로세스를 (인터페이스를 위한) 큐에 삽입
- 큐에 삽입된 순서대로 (한 번에 하나의 프로세스만) 공유 자원 이용

### 상호 배제를 위한 동기화
- 상호 배제를 위한 큐로 공유 자원에 대해 서로 충돌을 방지

### 실행 순서 제어를 위한 동기화
- 조건 변수에 대한 **큐** 들로 프로세스나 스레드의 실행 순서를 제어할 수 있다.
- 조건 변수 (condition variable) 이용
- 프로세스나 스레드의 실행 순서를 제어하기 위해 사용하는 특별한 변수

- 조건변수X.signal() , 조건변수X.wait() 함수를 통해 실행 순서 제어 가능
  - 1.특정 프로세스가 아직 실행될 조건이 되지 않았을 때에는 wait() 울 통해 실행을 중단한다.
  - 2.특정 프로세스가 실행될 조건이 충족되었을 때에는 signal()을 통해 실행을 재개한다.

### 자바 진영에서 모니터
- 자바 진영에서는 synchronized 키워드가 해당 모니터 락을 사용하고 있다.
  - 자바 바이트 코드로 변환시, synchronized 블럭은 `monitorenter` `monitorexit` 으로 변하게 된다.
  - 특정 스레드가 임계 구역을 만나게 되면, 진입 후 lock() 을 걸어버리게 되고, 다른 스레드들은 임계구역 도달시 entry list 에서 대기하게 된다. (락 대기)
  - 임계구역 내부에서 wait() 을 호출시, `waitSet` 에서 대기하게 되고 `notify` 호출을 받을때까지 대기한다. (조건 대기)

```aidl
자바 모니터는 Entry List(락 대기 큐) 와
Wait Set(조건 대기 큐) 를 가진다.

synchronized에 진입하려다 실패한 스레드는 Entry List에서 BLOCKED 상태로 대기한다.

락을 가진 스레드가 wait()를 호출하면

락을 반납하고

Wait Set으로 이동하여 WAITING 상태가 된다.

notify()/notifyAll()이 호출되면
Wait Set의 스레드는 Entry List로 이동하여
다시 락 획득을 경쟁한다.
```

</details>